{% extends "base.html" %}

{% block content %}
<div class="card">
    <img src="{{ product.image.url }}" class="card-img-top" alt="{{ product.name }}">
    <div class="card-body">
        <h5 class="card-title">{{ product.name }}</h5>
        <p class="card-text">{{ product.description }}</p>
        <p class="card-text">${{ product.price }}</p>

        <!-- Buttons Container -->
        <div class="d-flex justify-content-between mt-3">
            <!-- Add to Cart Button -->
            <form action="{% url 'cart:add_to_cart' product.id %}" method="post"> 
                {% csrf_token %}
                <button type="submit" class="btn btn-success">Add to Cart</button>
            </form>

            <!-- Add to Wishlist Button -->
            <form action="{% url 'add_to_wishlist' product.id %}" method="post">
                {% csrf_token %}
                <button type="submit" class="btn btn-secondary">Add to Wishlist</button>
            </form>
        </div>
    </div>
</div>

<!-- Review Form (Visible if user is logged in) -->
{% if user.is_authenticated %}
<h3>Write a Review</h3>
<form method="post" action="{% url 'add_review' product.id %}">
    {% csrf_token %}
    <div class="mb-3">
        <label for="comment" class="form-label">Your Review</label>
        <textarea name="comment" id="comment" class="form-control" rows="4" required></textarea>
    </div>
    <div class="mb-3">
        <label for="rating" class="form-label">Rating</label>
        <select name="rating" id="rating" class="form-control" required>
            <option value="1">1 Star</option>
            <option value="2">2 Stars</option>
            <option value="3">3 Stars</option>
            <option value="4">4 Stars</option>
            <option value="5">5 Stars</option>
        </select>
    </div>
    <button type="submit" class="btn btn-primary">Submit Review</button>
</form>
{% else %}
<p>Please <a href="{% url 'account_login' %}">log in</a> to leave a review.</p>
{% endif %}

<h3>Reviews:</h3>
{% for review in reviews %}
<div>
    <strong>{{ review.user.username }}</strong> (Rating: {{ review.rating }}):
    <p>{{ review.comment }}</p>
    {% if review.user == user %}
    <a href="{% url 'edit_review' review.id %}" class="btn btn-warning">Edit</a>
    <form action="{% url 'delete_review' review.id %}" method="post" style="display:inline;">
        {% csrf_token %}
        <button type="submit" class="btn btn-danger">Delete</button>
    </form>
    {% endif %}
</div>
{% empty %}
<p>No reviews yet.</p>
{% endfor %}
{% endblock %}
